let user_selectArray = [
    {
        subject: "Math",
        _checked: "/",
        topics: [
            {
                name: "Elementary Mathematics",
                _checked: "/",
                subtopics: [
                    {
                        name: "Basic Operations",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Addition",
                                _checked: "/"
                            },
                            {
                                name: "Subtraction",
                                _checked: "/"
                            },
                            {
                                name: "Multiplication",
                                _checked: "/"
                            },
                            {
                                name: "Division",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Integers",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Comparing Integers",
                                _checked: "/"
                            },
                            {
                                name: "Addition and Subtraction of Integers",
                                _checked: "/"
                            },
                            {
                                name: "Multiplication and Division of Integers",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Decimals",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Adding and Subtracting Decimals",
                                _checked: "/"
                            },
                            {
                                name: "Multiplication and Division of Decimals",
                                _checked: "/"
                            },
                            {
                                name: "Comparing Decimals",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Fractions",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Adding and Subtracting Fractions",
                                _checked: "/"
                            },
                            {
                                name: "Multiplying and Dividing Fractions",
                                _checked: "/"
                            },
                            {
                                name: "Simplifying Fractions",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Percentages",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Converting Percentages",
                                _checked: "/"
                            },
                            {
                                name: "Calculating Percentages",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Geometry",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Recognizing Shapes",
                                _checked: "/"
                            },
                            {
                                name: "Calculating Perimeter and Area",
                                _checked: "/"
                            },
                            {
                                name: "Calculating Volume",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Time",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Reading Clocks and Calendars",
                                _checked: "/"
                            },
                            {
                                name: "Time Calculations",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "Middle School Mathematics",
                _checked: "/",
                subtopics: [
                    {
                        name: "Algebra",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Linear Equations and Quadratic Equations",
                                _checked: "/"
                            },
                            {
                                name: "Inequalities",
                                _checked: "/"
                            },
                            {
                                name: "Polynomials and Factoring",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Geometry",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Corresponding Angles and Alternate Angles",
                                _checked: "/"
                            },
                            {
                                name: "Similarity and Congruence",
                                _checked: "/"
                            },
                            {
                                name: "Properties of Circles",
                                _checked: "/"
                            },
                            {
                                name: "Properties of Triangles",
                                _checked: "/"
                            },
                            {
                                name: "Parallel Lines and Trapezoids",
                                _checked: "/"
                            },
                            {
                                name: "Trigonometry",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Statistics and Probability",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Data Collection and Analysis",
                                _checked: "/"
                            },
                            {
                                name: "Basic Probability Concepts",
                                _checked: "/"
                            },
                            {
                                name: "Probability Calculations",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "High School Mathematics",
                _checked: "/",
                subtopics: [
                    {
                        name: "Trigonometry",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Properties and Graphs of Trigonometric Functions",
                                _checked: "/"
                            },
                            {
                                name: "Trigonometric Identities",
                                _checked: "/"
                            },
                            {
                                name: "Solving Trigonometric Equations",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Sequences and Series",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Arithmetic and Geometric Sequences",
                                _checked: "/"
                            },
                            {
                                name: "Summation of Sequences",
                                _checked: "/"
                            },
                            {
                                name: "Properties of Series",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Calculus",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Calculating Derivatives and their Applications",
                                _checked: "/"
                            },
                            {
                                name: "Indefinite and Definite Integrals",
                                _checked: "/"
                            },
                            {
                                name: "Differential Equations",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "University Mathematics",
                _checked: "/",
                subtopics: [
                    {
                        name: "Linear Algebra",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Matrices and Determinants",
                                _checked: "/"
                            },
                            {
                                name: "Vector Spaces and Linear Transformations",
                                _checked: "/"
                            },
                            {
                                name: "Eigenvalues and Eigenvectors",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Differential Equations",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Higher order Differential Equations",
                                _checked: "/"
                            },
                            {
                                name: "Solution Methods for Ordinary Differential Equations",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Probability and Statistics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Random Variables and Probability Distributions",
                                _checked: "/"
                            },
                            {
                                name: "Statistical Inference and Hypothesis Testing",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Complex_Analysis",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Complex-Numbers and Complex-Functions",
                                _checked: "/"
                            },
                            {
                                name: "Analytic Functions and Conformal-Mappings",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Linear Programming",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Modeling and Solving Linear Programming problems",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Discrete Mathematics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Graph Theory",
                                _checked: "/"
                            },
                            {
                                name: "Combinatorics",
                                _checked: "/"
                            },
                            {
                                name: "Applications of Discrete Mathematics in Computer Science",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        subject: "Physics",
        _checked: "/",
        topics: [
            {
                name: "Elementary Physics",
                _checked: "/",
                subtopics: [
                    {
                        name: "Basic Physics Concepts",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Matter and its Properties",
                                _checked: "/"
                            },
                            {
                                name: "Size Shape and Color of Objects",
                                _checked: "/"
                            },
                            {
                                name: "Position and Direction of Objects",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Force and Motion",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Concept of Force",
                                _checked: "/"
                            },
                            {
                                name: "Motion and Rest of Objects",
                                _checked: "/"
                            },
                            {
                                name: "Simple Machines",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "Middle School Physics",
                _checked: "/",
                subtopics: [
                    {
                        name: "Thermodynamics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Temperature and Temperature Measurement",
                                _checked: "/"
                            },
                            {
                                name: "Heat Conduction and Transfer",
                                _checked: "/"
                            },
                            {
                                name: "Thermal Expansion of Materials",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Electromagnetism",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Electric Charge and Static Electricity",
                                _checked: "/"
                            },
                            {
                                name: "Electric Current and Circuits",
                                _checked: "/"
                            },
                            {
                                name: "Magnetic Fields and Electromagnetic Induction",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Acoustics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Propagation of Sound",
                                _checked: "/"
                            },
                            {
                                name: "Characteristics and Frequency of Sound",
                                _checked: "/"
                            },
                            {
                                name: "Sound Reflection and Absorption",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "High School Physics",
                _checked: "/",
                subtopics: [
                    {
                        name: "Mechanics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Kinematics",
                                _checked: "/"
                            },
                            {
                                name: "Newton Laws and Equilibrium of Forces",
                                _checked: "/"
                            },
                            {
                                name: "Momentum and Energy",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Optics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Propagation and Reflection of Light",
                                _checked: "/"
                            },
                            {
                                name: "Mirrors and Lenses",
                                _checked: "/"
                            },
                            {
                                name: "Wave Particle Duality of Light",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Atomic and Nuclear Physics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Atomic Structure and the Periodic-table",
                                _checked: "/"
                            },
                            {
                                name: "Nuclear Reactions and Radioactive Decay",
                                _checked: "/"
                            },
                            {
                                name: "Structure of Atomic Nuclei",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "University Physics",
                _checked: "/",
                subtopics: [
                    {
                        name: "Thermodynamics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Ideal Gas Law",
                                _checked: "/"
                            },
                            {
                                name: "Thermodynamic Cycles",
                                _checked: "/"
                            },
                            {
                                name: "Entropy and the Second Law of Thermodynamics",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Electromagnetism",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Maxwell Equations",
                                _checked: "/"
                            },
                            {
                                name: "Electromagnetic Waves and the Propagation of Light",
                                _checked: "/"
                            },
                            {
                                name: "Interaction of Electromagnetic Fields",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Quantum Mechanics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Wave Particle Duality",
                                _checked: "/"
                            },
                            {
                                name: "Wave Functions and the Schrodinger Equation",
                                _checked: "/"
                            },
                            {
                                name: "Operators and Measurements in Quantum Mechanics",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Relativity",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Special Relativity and the Lorentz Transformation",
                                _checked: "/"
                            },
                            {
                                name: "Mass Energy Equivalence",
                                _checked: "/"
                            },
                            {
                                name: "Gravity and General Relativity",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Solid State Physics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Crystal Structures and Lattice Vibrations",
                                _checked: "/"
                            },
                            {
                                name: "Electronic Band Theory",
                                _checked: "/"
                            },
                            {
                                name: "Semiconductors and Conductors",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        subject: "Chemistry",
        _checked: "/",
        topics: [
            {
                name: "Elementary Chemistry",
                _checked: "/",
                subtopics: [
                    {
                        name: "Matter and Properties",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Classification of Matter",
                                _checked: "/"
                            },
                            {
                                name: "Properties of Matter",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Mixtures and Pure Substances",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Differences between Mixtures and Pure-Substances",
                                _checked: "/"
                            },
                            {
                                name: "Methods to Separate Mixtures",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "Middle School Chemistry",
                _checked: "/",
                subtopics: [
                    {
                        name: "Elements and Compounds",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Definitions of Elements and Compounds",
                                _checked: "/"
                            },
                            {
                                name: "Chemical Symbols and the Periodic-table",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Chemical Reactions",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Basic Concepts of Chemical Reactions",
                                _checked: "/"
                            },
                            {
                                name: "Chemical Reaction Equations",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Acids and Bases",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Properties of Acids and Bases",
                                _checked: "/"
                            },
                            {
                                name: "Neutralization Reactions",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "High School Chemistry",
                _checked: "/",
                subtopics: [
                    {
                        name: "Chemical Bonds and Molecular Structure",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Atomic and Molecular Structure",
                                _checked: "/"
                            },
                            {
                                name: "Covalent and Ionic Bonds",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Chemical Reaction Kinetics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Reaction Rates and Activation Energy",
                                _checked: "/"
                            },
                            {
                                name: "Chemical Equilibrium and Le-Chatelier-Principle",
                                _checked: "/"
                            },
                            {
                                name: "Equilibrium Constants for Chemical Reactions",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Chemical Thermodynamics",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Heat and Enthalpy",
                                _checked: "/"
                            },
                            {
                                name: "Thermochemical Equations",
                                _checked: "/"
                            },
                            {
                                name: "Reaction Enthalpy and Entropy Changes",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            },
            {
                name: "University Chemistry",
                _checked: "/",
                subtopics: [
                    {
                        name: "Organic Chemistry",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Structure and Nomenclature of Organic Molecules",
                                _checked: "/"
                            },
                            {
                                name: "Reaction Mechanisms in Organic Chemistry",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Inorganic Chemistry",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Metal and non-Metal Elements",
                                _checked: "/"
                            },
                            {
                                name: "Coordination Chemistry and Transition Metal Compounds",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Analytical Chemistry",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Methods of Chemical Analysis",
                                _checked: "/"
                            },
                            {
                                name: "Mass Spectrometry and Infrared Spectroscopy",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Properties of Matter",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Solubility and Solution Concentration",
                                _checked: "/"
                            },
                            {
                                name: "Redox Reactions",
                                _checked: "/"
                            }
                        ]
                    },
                    {
                        name: "Nuclear Chemistry",
                        _checked: "/",
                        subtopics: [
                            {
                                name: "Radioactive Decay Processes",
                                _checked: "/"
                            },
                            {
                                name: "Nuclear Reactions and Nuclear Energy",
                                _checked: "/"
                            }
                        ]
                    }
                ]
            }
        ]
    }
];

function isEmpty(obj) {
    return Object.keys(obj).length === 0;
}

function receiveObject() {
    const jsonStr = sessionStorage.getItem('myData'); // 获取存储在 sessionStorage 中的数据

    if (jsonStr) {
        const data = JSON.parse(jsonStr); // 将 JSON 字符串转换为对象
        sessionStorage.removeItem('myData'); // 获取数据后清空 sessionStorage 中的数据
        return data;
    } else {
        return {}; // 如果没有有效的数据，返回空对象
    }
}

let Teacher_SL_MOD = false;
let Test_MOD = false;
function main() {
    const receivedClass = receiveObject();
    console.log(receivedClass);
    if (isEmpty(receivedClass)) {
        get_Subject();
    } else {
        if (receivedClass.Typ == "Test") {
            Test_MOD = true;
            $X_Generate_(receivedClass.G_Setting, receivedClass.Setting, receivedClass.Task_settings, receivedClass.Class_ID);
        } else if (receivedClass.Typ == "Teacher") {
            Teacher_SL_MOD = true;
            get_Subject();
        }
    }
}

function replaceSlashWithFalse(obj, branchToProcess = null) {
    if (Array.isArray(obj)) {
        for (let i = 0; i < obj.length; i++) {
            if (branchToProcess === null || branchToProcess === i) {
                if (obj[i] === "/") {
                    obj[i] = false;
                }
                if (typeof obj[i] === 'object' || Array.isArray(obj[i])) {
                    replaceSlashWithFalse(obj[i], branchToProcess);
                }
            }
        }
    } else if (typeof obj === 'object') {
        for (let key in obj) {
            if (branchToProcess === null || branchToProcess === key) {
                if (obj[key] === "/") {
                    obj[key] = false;
                }
                if (typeof obj[key] === 'object' || Array.isArray(obj[key])) {
                    replaceSlashWithFalse(obj[key], branchToProcess);
                }
            }
        }
    }
}

function get_Subject() {
    X_Operate.newTitle("Courses (multiple choices)");
    let get_ = new Array();
    for (let i = 0; i < user_selectArray.length; i++) {
        get_.push(user_selectArray[i].subject);
    }
    X_Operate.newCheck(get_).then((back) => {
        X_Operate.newPage();
        X_Operate.newTitle("Levels (multiple choices)");
        for (let i = 0; i < back.length; i++) {
            if (back[i] !== true) {
                replaceSlashWithFalse(user_selectArray[i]);
            } else {
                user_selectArray[i]._checked = true;
            }
        }
        get_ = new Array();
        for (let i = 0; i < user_selectArray.length; i++) {
            if (user_selectArray[i]._checked == true) {
                for (let j = 0; j < user_selectArray[i].topics.length; j++) {
                    get_.push(user_selectArray[i].topics[j].name);
                }
            }
        }
        X_Operate.newCheck(get_).then((back) => {
            let f = 0;
            X_Operate.newPage();
            X_Operate.newTitle("Topics (multiple choices)");
            for (let i = 0; i < user_selectArray.length; i++) {
                for (let j = 0; j < user_selectArray[i].topics.length; j++) {
                    if (user_selectArray[i].topics[j]._checked == "/") {
                        if (back[f] == true) {
                            user_selectArray[i].topics[j]._checked = true;
                        } else {
                            replaceSlashWithFalse(user_selectArray[i].topics[j]);
                        }
                        f++;
                    }
                }
            }
            get_ = new Array();
            for (let i = 0; i < user_selectArray.length; i++) {
                if (user_selectArray[i]._checked == true) {
                    for (let j = 0; j < user_selectArray[i].topics.length; j++) {
                        if (user_selectArray[i].topics[j]._checked == true) {
                            for (let x = 0; x < user_selectArray[i].topics[j].subtopics.length; x++) {
                                get_.push(user_selectArray[i].topics[j].subtopics[x].name);
                            }
                        }
                    }
                }
            }
            X_Operate.newCheck(get_).then((back) => {
                let f = 0;
                X_Operate.newPage();
                X_Operate.newTitle("Types (multiple choices)");
                for (let i = 0; i < user_selectArray.length; i++) {
                    for (let j = 0; j < user_selectArray[i].topics.length; j++) {
                        for (let x = 0; x < user_selectArray[i].topics[j].subtopics.length; x++) {
                            if (user_selectArray[i].topics[j].subtopics[x]._checked == "/") {
                                if (back[f] == true) {
                                    user_selectArray[i].topics[j].subtopics[x]._checked = true;
                                } else {
                                    replaceSlashWithFalse(user_selectArray[i].topics[j].subtopics[x]);
                                }
                                f++;
                            }
                        }
                    }
                }
                get_ = new Array();
                for (let i = 0; i < user_selectArray.length; i++) {
                    if (user_selectArray[i]._checked == true) {
                        for (let j = 0; j < user_selectArray[i].topics.length; j++) {
                            if (user_selectArray[i].topics[j]._checked == true) {
                                for (let x = 0; x < user_selectArray[i].topics[j].subtopics.length; x++) {
                                    if (user_selectArray[i].topics[j].subtopics[x]._checked == true) {
                                        for (let n = 0; n < user_selectArray[i].topics[j].subtopics[x].subtopics.length; n++) {
                                            get_.push(user_selectArray[i].topics[j].subtopics[x].subtopics[n].name);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                X_Operate.newCheck(get_).then((back) => {
                    let f = 0;
                    X_Operate.newPage();
                    for (let i = 0; i < user_selectArray.length; i++) {
                        for (let j = 0; j < user_selectArray[i].topics.length; j++) {
                            for (let x = 0; x < user_selectArray[i].topics[j].subtopics.length; x++) {
                                for (let q = 0; q < user_selectArray[i].topics[j].subtopics[x].subtopics.length; q++) {
                                    if (user_selectArray[i].topics[j].subtopics[x].subtopics[q]._checked == "/") {
                                        if (back[f] == true) {
                                            user_selectArray[i].topics[j].subtopics[x].subtopics[q]._checked = true;
                                        } else {
                                            replaceSlashWithFalse(user_selectArray[i].topics[j].subtopics[x].subtopics[q]);
                                        }
                                        f++;
                                    }
                                }
                            }
                        }
                    }
                    console.log(user_selectArray);
                    window_load(false, 0);
                    window_load(true, 1000);
                    X_Generate(user_selectArray);
                });
            });
        });
    });
}